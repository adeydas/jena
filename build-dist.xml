<project xmlns:ivy="antlib:org.apache.ivy.ant" name="dist">
  
  <!-- ========================================== -->
  <!-- Additional functionality for creating a zipped release
       Assumes build-lib.xml is imported
   -->
  <!-- Distribution area -->

  <property name="dist.name"              value="${Name}-${version}"/>

  <property name="dist.root"              value="build/dist"/>
  <property name="dist.dir"               value="${dist.root}/${dist.name}"/>

  <property name="release.zipfile.name"   value="${name}-${version}.zip"/>
  <property name="release.zipfile"        value="${artifacts.dir}/${release.zipfile.name}"/>

  <!-- ==== Release -->

  <target name="release" depends="clean-once,package"
	  description="Build a release zip"/>

  <target name="package" depends="copy-init,copy-dist,zip-release"/>

  <target name="copy-init">
    <delete dir="${dist.dir}" />
    <mkdir dir="${dist.dir}" />
    <mkdir dir="${artifacts.dir}"/>
    <mkdir dir="${dist.dir}/${lib.dir}"/>
  </target>

  <target name="copy-dist" depends="copy-init,jar,javadoc,test">
    <copy todir="${dist.dir}/${lib.dir}">
      <fileset dir="${lib.dir}" 
	       includes="*.jar" 
	       excludes="${jarfile},*sources.jar,*javadoc.jar,*tests.jar"/>
      <fileset dir="${build.dir}" includes="${jarfile}"/>
    </copy>

    <!-- Source code -->
    <zip zipfile="${dist.dir}/${src.zipfile}">
      <fileset refid="fileset.src"/>
    </zip>

    <copy todir="${dist.dir}/${test.dir}">
      <fileset dir="${test.dir}"/>
    </copy>

    <copy todir="${dist.dir}/Store">
      <fileset dir="Store"/>
    </copy>
    
    <!-- bin/ (and bat/ if any) -->
    <copy todir="${dist.dir}/bin">
      <fileset dir="bin"/>
    </copy>
    <copy todir="${dist.dir}/bin2">
      <fileset dir="bin2"/>
    </copy>

    <copy todir="${dist.dir}/" file="copyright.txt"/>
    <copy todir="${dist.dir}/" file="README.txt"/>
    <copy todir="${dist.dir}/" file="ChangeLog.txt"/>
    <copy todir="${dist.dir}/" file="tdb.ttl"/>

    <!-- Documentation -->
    <copy todir="${dist.dir}/${doc.dir}">
      <fileset dir="${doc.dir}">
	<include name="**" />
	<exclude name="**/_vti*/**" />
	<exclude name="**/_private/**" />
	<exclude name="**/javadoc-all/**"/>
	<exclude name="**/desktop.ini" />
      </fileset>
    </copy>
  </target>

  <target name="zip-release">
    <!-- Build the zip of the distribution -->
    <delete file="${release.zipfile}"/>
    <zip zipfile="${release.zipfile}">
      <fileset dir="${dist.root}" includes="${dist.name}/**"/>
    </zip>
  </target>

  <!-- To calm error checking -->
  <target name="test"/>
  <target name="clean"/>
  <target name="clean-once"/>
  <target name="artifacts"/>
  <target name="jar"/>
  <target name="javadoc"/>
  
  <target name="clean-dist">
    <delete dir="${dist.root}"/>
  </target>

  <target name="clean-dist-area" description="Clean distribution area">
    <delete dir="${dist.root}"/>
    <mkdir  dir="${dist.root}"/>
  </target>

</project>
