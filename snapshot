#!/bin/bash

MODULE="$@"
#DEFAULT="TDB SDB Joseki3"
DEFAULT="TDB"


for m in $MODULE
do
  if [ "$m" = "ARQ" ]
      then
      echo "Error: can't snapshot ARQ to itself" 1>&2
      exit 1
  fi
  done

# Where to move the jars to
if [ "$MODULE" != "" ]
then
    LIBDIRS="$MODULE"
    SRCDIRS="$MODULE"
else
    LIBDIRS="${LIBDIR:-$DEFAULT}"
    SRCDIRS="${SRCDIR:-$DEFAULT}"
fi

#ant clean build

# Remove path and version numbers.
function jarName
{
    local JAR="$1"
    perl -e '$_=$ARGV[0] ; s!(.*/)?([^/]*)-\d.\d.\d.*.jar!$2.jar! ; print "$_\n"' $JAR
}

## # Remove version numbers
## for jar in build/arq*.jar
## do
##   J2="$(perl -e '$_=$ARGV[0] ; s/(arq.*)-\d.\d.\d.*.jar/$1.jar/ ; print "$_\n" ' $jar)"
##   mv $jar $J2
##   done


for d in $LIBDIRS
do
  echo "Moving ARQ jars to project $d"
  
  for jar in build/arq*.jar
    do
    J2=$(jarName $jar)
    cp -u $jar ../$d/lib/$J2
    done
  ## Fix up 
  chmod u+rw ../$d/lib/arq*jar
  # And Jena
  cp -u lib/jena.jar ../$d/lib
  cp -u lib/jenatest.jar ../$d/lib
  done
exit

## rm build/arq*.jar

## Source code.

rm -f arq-src.zip

for d in src src-dev src-test
do
  ( cd $d ; find . -name test -prune -o -name .svn -prune -o -print | \
    xargs -n 200 zip -q ../arq-src.zip
  )
  done

for d in  $SRCDIRS
do
  echo "Moving arq-src.zip to project $d"
  cp -u arq-src.zip ../$d
  # And Jena
  cp -u jena-src.zip ../$d
  done

rm -f arq-src.zip
